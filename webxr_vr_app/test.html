<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura VR - Button Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .test-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .status.connected {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        
        .status.disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #F44336;
        }
        
        .status.processing {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        
        .log-success { background: rgba(76, 175, 80, 0.2); }
        .log-error { background: rgba(244, 67, 54, 0.2); }
        .log-info { background: rgba(33, 150, 243, 0.2); }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéÆ Aura VR - Button Functionality Test</h1>
        <p>This page tests the button functionality without requiring VR. Use this to verify your backend connection and API endpoints.</p>
        
        <div id="status" class="status disconnected">
            üî¥ Disconnected from Backend
        </div>
        
        <div>
            <button id="connect-btn" onclick="testConnect()">
                üîó Test Backend Connection
            </button>
            <button id="capture-btn" onclick="testCapture()" disabled>
                üì∏ Test Screenshot Upload
            </button>
            <button id="analyze-btn" onclick="testAnalyze()" disabled>
                üîç Test Image Analysis
            </button>
            <button id="voice-btn" onclick="testVoice()" disabled>
                üé§ Test Voice Query
            </button>
        </div>
        
        <div id="audio-container" style="display: none; margin-top: 20px;">
            <h3>üéµ Generated Audio:</h3>
            <audio id="audio-player" controls></audio>
        </div>
        
        <div class="log" id="log">
            <h3>üìã Test Log:</h3>
            <div id="log-entries"></div>
        </div>
    </div>

    <script>
        const backendUrl = 'http://192.168.34.160:8001';
        let sessionId = null;
        let currentImageId = null;
        let isConnected = false;
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function updateStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        function enableButtons() {
            document.getElementById('capture-btn').disabled = false;
            document.getElementById('analyze-btn').disabled = false;
            document.getElementById('voice-btn').disabled = false;
        }
        
        async function testConnect() {
            try {
                log('Testing backend connection...', 'info');
                updateStatus('üîÑ Testing connection...', 'processing');
                
                const response = await fetch(`${backendUrl}/ping`);
                if (!response.ok) {
                    throw new Error('Backend not responding');
                }
                
                log('‚úÖ Backend ping successful', 'success');
                
                // Create session
                const sessionResponse = await fetch(`${backendUrl}/voice/session/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: `test_user_${Date.now()}` })
                });
                
                if (sessionResponse.ok) {
                    const sessionData = await sessionResponse.json();
                    sessionId = sessionData.session_id;
                    isConnected = true;
                    updateStatus('üü¢ Connected to Backend', 'connected');
                    enableButtons();
                    log(`‚úÖ Session created: ${sessionId}`, 'success');
                } else {
                    throw new Error('Failed to create session');
                }
            } catch (error) {
                log(`‚ùå Connection failed: ${error.message}`, 'error');
                updateStatus('üî¥ Connection Failed', 'disconnected');
                isConnected = false;
            }
        }
        
        async function testCapture() {
            if (!isConnected) {
                log('‚ùå Not connected to backend', 'error');
                return;
            }
            
            try {
                log('üì∏ Testing screenshot upload...', 'info');
                updateStatus('üì∏ Testing upload...', 'processing');
                
                // Create a test image (simple canvas)
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext('2d');
                
                // Draw a simple test pattern
                ctx.fillStyle = '#667eea';
                ctx.fillRect(0, 0, 640, 480);
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.fillText('Test Image', 200, 240);
                ctx.font = '24px Arial';
                ctx.fillText('Generated for VR testing', 180, 280);
                
                // Convert to blob
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.8));
                
                // Upload
                const formData = new FormData();
                formData.append('image', blob, 'test_screenshot.jpg');
                formData.append('user_id', `test_user_${Date.now()}`);
                formData.append('session_id', sessionId);
                
                const response = await fetch(`${backendUrl}/upload-image`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentImageId = data.image_id;
                    log(`‚úÖ Upload successful: ${currentImageId}`, 'success');
                    updateStatus('‚úÖ Test upload successful', 'connected');
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                log(`‚ùå Upload test failed: ${error.message}`, 'error');
                updateStatus('üî¥ Upload failed', 'disconnected');
            }
        }
        
        async function testAnalyze() {
            if (!currentImageId) {
                log('‚ùå No image uploaded', 'error');
                return;
            }
            
            try {
                log('üîç Testing image analysis...', 'info');
                updateStatus('üîç Testing analysis...', 'processing');
                
                const response = await fetch(`${backendUrl}/analyze-image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_id: currentImageId,
                        query: 'What do you see in this test image?',
                        session_id: sessionId
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Analysis successful: ${data.description.substring(0, 100)}...`, 'success');
                    updateStatus('‚úÖ Analysis test successful', 'connected');
                    
                    // Test audio playback
                    if (data.audio_url) {
                        const audioPlayer = document.getElementById('audio-player');
                        const audioContainer = document.getElementById('audio-container');
                        audioPlayer.src = `${backendUrl}${data.audio_url}`;
                        audioContainer.style.display = 'block';
                        log('üéµ Audio response available', 'success');
                    }
                } else {
                    throw new Error('Analysis failed');
                }
            } catch (error) {
                log(`‚ùå Analysis test failed: ${error.message}`, 'error');
                updateStatus('üî¥ Analysis failed', 'disconnected');
            }
        }
        
        async function testVoice() {
            if (!currentImageId) {
                log('‚ùå No image uploaded', 'error');
                return;
            }
            
            try {
                log('üé§ Testing voice query...', 'info');
                updateStatus('üé§ Testing voice...', 'processing');
                
                const response = await fetch(`${backendUrl}/analyze-image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_id: currentImageId,
                        query: 'This is a test voice query about the image',
                        session_id: sessionId
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Voice query successful: ${data.description.substring(0, 100)}...`, 'success');
                    updateStatus('‚úÖ Voice test successful', 'connected');
                    
                    if (data.audio_url) {
                        const audioPlayer = document.getElementById('audio-player');
                        const audioContainer = document.getElementById('audio-container');
                        audioPlayer.src = `${backendUrl}${data.audio_url}`;
                        audioContainer.style.display = 'block';
                        log('üéµ Voice response audio available', 'success');
                    }
                } else {
                    throw new Error('Voice query failed');
                }
            } catch (error) {
                log(`‚ùå Voice test failed: ${error.message}`, 'error');
                updateStatus('üî¥ Voice failed', 'disconnected');
            }
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            log('üöÄ Test page loaded', 'info');
            log('Click "Test Backend Connection" to start', 'info');
        });
    </script>
</body>
</html> 